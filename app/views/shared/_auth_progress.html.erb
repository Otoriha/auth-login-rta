<% if session[:auth_flow].present? %>
  <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">ログインRTA 進捗状況</h2>

    <div class="flex items-center justify-between mb-2">
      <% steps = [
        { name: "GitHub", provider: "github" },
        { name: "X (Twitter)", provider: "twitter2" },
        { name: "Google", provider: "google_oauth2" }
      ] %>

      <% steps.each_with_index do |step, index| %>
        <%
          current_step = session[:auth_flow]["step"].to_i
          is_completed = session[:auth_flow]["completed"]&.include?(step[:provider])
          is_current = current_step == index + 1
          status_class = is_completed ? "bg-emerald-600 text-white" :
                         is_current ? "bg-blue-600 text-white animate-pulse" : "bg-gray-300"
          status_text = is_completed ? "完了" : is_current ? "進行中" : "未着手"
        %>

        <div class="flex flex-col items-center">
          <div class="relative">
            <div class="w-12 h-12 flex items-center justify-center rounded-full <%= status_class %> font-bold">
              <%= index + 1 %>
            </div>
            <% if is_completed %>
              <div class="absolute -top-1 -right-1 w-6 h-6 bg-emerald-600 rounded-full flex items-center justify-center">
                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
            <% end %>
          </div>
          <span class="mt-2 text-sm font-medium"><%= step[:name] %></span>
          <span class="text-xs <%= is_current ? 'text-blue-600 font-bold' : is_completed ? 'text-emerald-600' : 'text-gray-500' %>">
            <%= status_text %>
          </span>
        </div>

        <% if index < steps.length - 1 %>
          <%
            line_class = if index < current_step - 1
                          "bg-emerald-600"
                        else
                          "bg-gray-300"
                        end
          %>
          <div class="flex-1 h-1.5 <%= line_class %>"></div>
        <% end %>
      <% end %>
    </div>

    <div class="mt-4 text-gray-600 text-sm">
      <p>現在のステップ: <%= session[:auth_flow]["step"] %> / 3</p>
      <p>開始時間: <%= Time.parse(session[:auth_flow]["started_at"].to_s).strftime('%H:%M:%S') if session[:auth_flow]["started_at"] %></p>
    </div>
  </div>
<% end %>